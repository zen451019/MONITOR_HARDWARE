# Three-phase Current Transducer

The current transducer is the element responsible for capturing the electrical current present in the electromechanical system and transforming it into a signal suitable for the microcontroller's acquisition stage, through the corresponding conditioning. There are multiple variants of current transducers, based on principles such as the Hall effect, shunt resistance, or current transformer, and available with analog or digital outputs, depending on the interface requirements and system specifications.

## SCT-013-000 Sensor

The SCT-013-000 is a non-invasive split-core AC current transducer that uses a current transformer to measure AC with galvanic isolation. In its variant (100 A : 50 mA), it delivers a proportional current signal that requires an external load resistance (burden) to convert it into a voltage suitable for reading by microcontrollers.

<p style="text-align:center;"> <img src="../../res/img/hardware/SCT-013-000.png" style="width:45%;"> </p>

### Features
- Clip-type split core, installation without interrupting the circuit and with safe galvanic isolation.
- Transformation ratio 100 A : 50 mA (model SCT-013-000, without integrated load resistance).
- Requires external burden resistance sized according to the ADC range and the current level to be measured.
- Analog output proportional to the primary current; requires center bias for AC reading with 3.3 V or 5 V ADC.
- Nominal frequency 50/60 Hz; good linearity in residential and industrial applications.

## Signal Conditioning

The SCT-013-000 delivers an AC signal on its secondary side proportional to the current flowing through the primary side, operating as a current transformer. In this version (100 A : 50 mA), the ratio is 2000:1, so that, for example, if 50 A RMS flows through the primary, 25 mA RMS will flow through the secondary. In order for the microcontroller to register this magnitude, it is necessary to convert the secondary current into a voltage using a load resistor (**burden**) connected in parallel between the sensor terminals. According to Ohm's law, the resulting voltage is :  $$V = I_{sec} × R_{burden}$$
To size the **burden** resistance, the target voltage level at the sensor output must be considered so that the input range of the analog-to-digital converter (ADC) of the [ESP32](./central_controller.md), typically 0 to 3.3 V, is not exceeded. Consequently, the voltage generated by the secondary current through the **burden** must be, at most, equal to or less than the ADC limit. In AC applications, it is common to add a DC bias at the midpoint of the ADC scale to center the signal within the 0–3.3 V range and avoid clipping.

![[../../res/img/hardware/Sensor_and_conditioning.drawio.svg]]

A voltage range of 2.828 V has been considered, which is comfortably within the ADC range. By not operating near its limits, there is sufficient safety margin to reduce the risk of signal saturation and clipping.

Assuming a target voltage of

$$
2.828 V_{pico a pico} = 1.414 V_{pico}
$$
With a max current value
$$
I_{RMS(sec)} = 50 mA
$$
To resolve R
$$
I_{RMS(sec)} × R_{burden} = V_{RMS}   
$$
$$
50mA × R_{burden} =  \frac{ V_{pico} }{\sqrt{2}} 
$$
$$
50mA × R_{burden} =  \frac{ 1.414 V_{pico} }{\sqrt{2}} = 1 V_{RMS}
$$
$$
R_{burden} \approx 20 \Omega
$$

As a result, the necessary load resistance (burden) is approximately 20 Ω. It is still necessary to add a bias voltage to the signal, as otherwise half of the amplitude would be lost due to the microcontroller's inability to measure negative voltages. To take advantage of the widest possible dynamic range, this bias is set at half the measurement range, for which a voltage divider is used. The following equation represents the output voltage as a function of the input voltage to the voltage divider.

<p style="text-align:center;"> <img src="../../res/img/hardware/divisor.drawio.svg" style="width:50%;"> </p>

$$
V_{out} = V_{in} \frac{ R_2 }{R_1 + R_2}
$$
If R2 = R1
$$
V_{out} = V_{in} \frac{ R_2 }{2 R_2}
$$
$$
V_{out} =  \frac{ V_{in} }{2}
$$

To limit the current, R = 10 kΩ is selected. With this value, the following conditioning circuit is proposed for the SCT-013-000 AC current sensor (100 A / 50 mA).


![[../../res/img/hardware/Diagrama_sensor_corriente.drawio.svg]]

A 100 nF capacitor is added as an anti-aliasing filter and another 10 µF capacitor to keep the bias voltage stable. Like the [voltage sensor](./voltage_sensor.md), the sensor and its conditioning circuit can only measure a single-phase signal. To compensate for this and obtain two-phase or three-phase measurements, the use of three sensors with their respective conditioning circuits is proposed; in this way, each one is responsible for one voltage line and complete measurements are obtained.